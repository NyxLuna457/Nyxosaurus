"use strict";(self.webpackChunkmy_tutorial_wiki=self.webpackChunkmy_tutorial_wiki||[]).push([[640],{8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var l=i(6540);const s={},t=l.createContext(s);function r(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(t.Provider,{value:n},e.children)}},9150:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"Projet-Application-Python/Mise-en-place-CICD","title":"Mise en place d\'une logique CI/CD","description":"Ce guide explique comment mettre en place un d\xe9ploiement continu (CI/CD) pour une application Python sur une VM Ubuntu, en utilisant Tailscale pour un acc\xe8s r\xe9seau priv\xe9, PM2 comme gestionnaire de processus Python, et un workflow GitHub Actions (fichier .yml) pour automatiser le d\xe9ploiement \xe0 chaque git push.","source":"@site/docs/Projet-Application-Python/Mise-en-place-CICD.md","sourceDirName":"Projet-Application-Python","slug":"/Projet-Application-Python/Mise-en-place-CICD","permalink":"/Nyxosaurus/docs/Projet-Application-Python/Mise-en-place-CICD","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Projet-Application-Python/Mise-en-place-CICD.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Monitoring via Grafana/Prometheus","permalink":"/Nyxosaurus/docs/Projet-Application-Python/Monitoring"}}');var s=i(4848),t=i(8453);const r={},o="Mise en place d'une logique CI/CD",a={},c=[{value:"Sommaire",id:"sommaire",level:2},{value:"1. Pr\xe9-requis",id:"1-pr\xe9-requis",level:2},{value:"2. Installation et configuration de Tailscale",id:"2-installation-et-configuration-de-tailscale",level:2},{value:"a. Installer Tailscale sur la VM Ubuntu",id:"a-installer-tailscale-sur-la-vm-ubuntu",level:3},{value:"b. V\xe9rifier l\u2019adresse Tailscale de la VM",id:"b-v\xe9rifier-ladresse-tailscale-de-la-vm",level:3},{value:"3. Installation et configuration de PM2 pour Python",id:"3-installation-et-configuration-de-pm2-pour-python",level:2},{value:"a. Installer Node.js et PM2",id:"a-installer-nodejs-et-pm2",level:3},{value:"b. Lancer l\u2019application Python avec PM2",id:"b-lancer-lapplication-python-avec-pm2",level:3},{value:"c. S\u2019assurer que l\u2019application red\xe9marre au reboot",id:"c-sassurer-que-lapplication-red\xe9marre-au-reboot",level:3},{value:"d. Commandes utiles PM2",id:"d-commandes-utiles-pm2",level:3},{value:"4. Pr\xe9paration de la VM Ubuntu pour le d\xe9ploiement Python",id:"4-pr\xe9paration-de-la-vm-ubuntu-pour-le-d\xe9ploiement-python",level:2},{value:"a. Cloner le d\xe9p\xf4t sur la VM",id:"a-cloner-le-d\xe9p\xf4t-sur-la-vm",level:3},{value:"b. Cr\xe9er un script de d\xe9ploiement",id:"b-cr\xe9er-un-script-de-d\xe9ploiement",level:3},{value:"5. Configuration du workflow GitHub Actions (<code>.github/workflows/deploy.yml</code>)",id:"5-configuration-du-workflow-github-actions-githubworkflowsdeployyml",level:2},{value:"6. S\xe9curisation et tests",id:"6-s\xe9curisation-et-tests",level:2},{value:"7. R\xe9sum\xe9 du flux",id:"7-r\xe9sum\xe9-du-flux",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"mise-en-place-dune-logique-cicd",children:"Mise en place d'une logique CI/CD"})}),"\n",(0,s.jsx)(n.h1,{id:"d\xe9ploiement-automatis\xe9-via-tailscale-github-actions-et-pm2",children:"D\xe9ploiement automatis\xe9 via Tailscale, GitHub Actions et PM2"}),"\n",(0,s.jsxs)(n.p,{children:["Ce guide explique comment mettre en place un d\xe9ploiement continu (CI/CD) pour une ",(0,s.jsx)(n.strong,{children:"application Python"})," sur une VM Ubuntu, en utilisant ",(0,s.jsx)(n.strong,{children:"Tailscale"})," pour un acc\xe8s r\xe9seau priv\xe9, ",(0,s.jsx)(n.strong,{children:"PM2"})," comme gestionnaire de processus Python, et un workflow GitHub Actions (fichier ",(0,s.jsx)(n.code,{children:".yml"}),") pour automatiser le d\xe9ploiement \xe0 chaque ",(0,s.jsx)(n.code,{children:"git push"}),"."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"sommaire",children:"Sommaire"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Pr\xe9-requis"}),"\n",(0,s.jsx)(n.li,{children:"Installation et configuration de Tailscale"}),"\n",(0,s.jsx)(n.li,{children:"Installation et configuration de PM2 pour Python"}),"\n",(0,s.jsx)(n.li,{children:"Pr\xe9paration de la VM Ubuntu pour le d\xe9ploiement Python"}),"\n",(0,s.jsxs)(n.li,{children:["Configuration du workflow GitHub Actions (",(0,s.jsx)(n.code,{children:".github/workflows/deploy.yml"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"S\xe9curisation et tests"}),"\n",(0,s.jsx)(n.li,{children:"R\xe9sum\xe9 du flux"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"1-pr\xe9-requis",children:"1. Pr\xe9-requis"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Un d\xe9p\xf4t GitHub pour ton application Python."}),"\n",(0,s.jsx)(n.li,{children:"Une VM Ubuntu Server (h\xe9bergeant l\u2019application Python et MariaDB)."}),"\n",(0,s.jsx)(n.li,{children:"Un compte Tailscale et Tailscale install\xe9 sur la VM Ubuntu."}),"\n",(0,s.jsx)(n.li,{children:"Un Tailscale Auth Key (cl\xe9 d\u2019authentification pour CI/CD)."}),"\n",(0,s.jsx)(n.li,{children:"Un acc\xe8s SSH \xe0 la VM Ubuntu (via Tailscale)."}),"\n",(0,s.jsxs)(n.li,{children:["Un fichier ",(0,s.jsx)(n.code,{children:".yml"})," pour GitHub Actions."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"2-installation-et-configuration-de-tailscale",children:"2. Installation et configuration de Tailscale"}),"\n",(0,s.jsx)(n.h3,{id:"a-installer-tailscale-sur-la-vm-ubuntu",children:"a. Installer Tailscale sur la VM Ubuntu"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'\ncurl -fsSL https://tailscale.com/install.sh | sh\nsudo tailscale up --authkey=<TAILSCALE_AUTHKEY> --hostname="ubuntu-app-server"\n\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["G\xe9n\xe8re un Auth Key sur le dashboard Tailscale (section Keys), choisis une cl\xe9 ",(0,s.jsx)(n.strong,{children:"ephemeral"})," et ",(0,s.jsx)(n.strong,{children:"reusable"})," pour CI/CD."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"b-v\xe9rifier-ladresse-tailscale-de-la-vm",children:"b. V\xe9rifier l\u2019adresse Tailscale de la VM"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\ntailscale ip -4\n\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Note cette IP (ex: ",(0,s.jsx)(n.code,{children:"100.x.x.x"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"3-installation-et-configuration-de-pm2-pour-python",children:"3. Installation et configuration de PM2 pour Python"}),"\n",(0,s.jsx)(n.h3,{id:"a-installer-nodejs-et-pm2",children:"a. Installer Node.js et PM2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\ncurl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -\nsudo apt install -y nodejs\nsudo npm install -g pm2\n\n"})}),"\n",(0,s.jsx)(n.h3,{id:"b-lancer-lapplication-python-avec-pm2",children:"b. Lancer l\u2019application Python avec PM2"}),"\n",(0,s.jsxs)(n.p,{children:["Depuis le dossier de ton projet (par exemple ",(0,s.jsx)(n.code,{children:"/opt/ton-repo"}),")\u202f:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\npm2 start app.py --interpreter /usr/bin/python3 --name myapp\n\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--interpreter /usr/bin/python3"})," force l\u2019utilisation de Python 3."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--name myapp"})," donne un nom \xe0 ton processus."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"c-sassurer-que-lapplication-red\xe9marre-au-reboot",children:"c. S\u2019assurer que l\u2019application red\xe9marre au reboot"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\npm2 startup\n\n# Suis l\u2019instruction affich\xe9e (copie/colle la commande g\xe9n\xe9r\xe9e)\n\npm2 save\n\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Cela garantit que PM2 relancera ton appli Python automatiquement apr\xe8s un red\xe9marrage du serveur[^5]."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"d-commandes-utiles-pm2",children:"d. Commandes utiles PM2"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Red\xe9marrer l\u2019appli\u202f: ",(0,s.jsx)(n.code,{children:"pm2 restart myapp"})]}),"\n",(0,s.jsxs)(n.li,{children:["Voir les logs\u202f: ",(0,s.jsx)(n.code,{children:"pm2 logs myapp"})]}),"\n",(0,s.jsxs)(n.li,{children:["Lister les apps\u202f: ",(0,s.jsx)(n.code,{children:"pm2 list"})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"4-pr\xe9paration-de-la-vm-ubuntu-pour-le-d\xe9ploiement-python",children:"4. Pr\xe9paration de la VM Ubuntu pour le d\xe9ploiement Python"}),"\n",(0,s.jsx)(n.h3,{id:"a-cloner-le-d\xe9p\xf4t-sur-la-vm",children:"a. Cloner le d\xe9p\xf4t sur la VM"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\ncd /opt\ngit clone git@github.com:ton-utilisateur/ton-repo.git\ncd ton-repo\n\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Configure les cl\xe9s SSH pour permettre le ",(0,s.jsx)(n.code,{children:"git pull"})," sans mot de passe."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"b-cr\xe9er-un-script-de-d\xe9ploiement",children:"b. Cr\xe9er un script de d\xe9ploiement"}),"\n",(0,s.jsxs)(n.p,{children:["Dans ",(0,s.jsx)(n.code,{children:"/opt/ton-repo/deploy.sh"}),"\u202f:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\n\\#!/bin/bash\ngit pull origin main\npm2 restart myapp\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"Rends-le ex\xe9cutable\u202f:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\nchmod +x deploy.sh\n\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h2,{id:"5-configuration-du-workflow-github-actions-githubworkflowsdeployyml",children:["5. Configuration du workflow GitHub Actions (",(0,s.jsx)(n.code,{children:".github/workflows/deploy.yml"}),")"]}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9e un fichier ",(0,s.jsx)(n.code,{children:".github/workflows/deploy.yml"})," dans ton d\xe9p\xf4t GitHub\u202f:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\nname: Deploy to Ubuntu App Server via Tailscale and PM2\n\non:\npush:\nbranches:\n- main\n\njobs:\ndeploy:\nruns-on: ubuntu-latest\n\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n    \n      - name: Set up Tailscale\n        uses: tailscale/github-action@v3\n        with:\n          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}\n    \n      - name: Wait for Tailscale\n        run: sleep 5\n    \n      - name: Deploy via SSH\n        env:\n          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}\n        run: |\n          echo \"$SSH_PRIVATE_KEY\" > id_rsa\n          chmod 600 id_rsa\n          ssh -o StrictHostKeyChecking=no -i id_rsa ubuntu@<IP_TAILSCALE_VM> 'cd /opt/ton-repo && ./deploy.sh'\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Remplace ",(0,s.jsx)(n.code,{children:"<IP_TAILSCALE_VM>"})," par l\u2019IP Tailscale de ta VM Ubuntu (ex\u202f: ",(0,s.jsx)(n.code,{children:"100.x.x.x"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"TAILSCALE_AUTHKEY"})," et ",(0,s.jsx)(n.code,{children:"SSH_PRIVATE_KEY"})," sont \xe0 stocker dans les secrets GitHub."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"6-s\xe9curisation-et-tests",children:"6. S\xe9curisation et tests"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Secrets GitHub"}),"\u202f: Ajoute ",(0,s.jsx)(n.code,{children:"TAILSCALE_AUTHKEY"})," et ",(0,s.jsx)(n.code,{children:"SSH_PRIVATE_KEY"})," dans les param\xe8tres du d\xe9p\xf4t GitHub (Settings > Secrets and variables > Actions)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Test du workflow"}),"\u202f: Fais une modification et un ",(0,s.jsx)(n.code,{children:"git push"})," sur ",(0,s.jsx)(n.code,{children:"main"}),". V\xe9rifie sur GitHub Actions que le workflow s\u2019ex\xe9cute sans erreur et que l\u2019application Python est red\xe9ploy\xe9e sur la VM."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Logs"}),"\u202f: Consulte les logs du workflow GitHub et ceux de ",(0,s.jsx)(n.code,{children:"pm2 logs myapp"})," sur la VM pour diagnostiquer d\u2019\xe9ventuels probl\xe8mes."]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"7-r\xe9sum\xe9-du-flux",children:"7. R\xe9sum\xe9 du flux"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Tu fais un ",(0,s.jsx)(n.code,{children:"git push"})," sur la branche ",(0,s.jsx)(n.code,{children:"main"})," de ton d\xe9p\xf4t GitHub."]}),"\n",(0,s.jsxs)(n.li,{children:["GitHub Actions lance le workflow d\xe9fini dans ",(0,s.jsx)(n.code,{children:".github/workflows/deploy.yml"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Le workflow \xe9tablit une connexion Tailscale, puis se connecte en SSH \xe0 ta VM Ubuntu via son IP Tailscale."}),"\n",(0,s.jsxs)(n.li,{children:["Il ex\xe9cute le script de d\xe9ploiement (",(0,s.jsx)(n.code,{children:"deploy.sh"}),") sur la VM, qui fait un ",(0,s.jsx)(n.code,{children:"git pull"})," et red\xe9marre l\u2019application Python via PM2."]}),"\n",(0,s.jsx)(n.li,{children:"Les changements sont appliqu\xe9s automatiquement, de mani\xe8re s\xe9curis\xe9e et priv\xe9e gr\xe2ce \xe0 Tailscale."}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"Avec cette m\xe9thode, tu b\xe9n\xe9ficies d\u2019un d\xe9ploiement continu s\xe9curis\xe9, sans exposition de ports publics, et d\u2019une gestion simplifi\xe9e de ton application Python gr\xe2ce \xe0 PM2."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);